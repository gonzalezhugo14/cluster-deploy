{% raw %}
    #
    # Applications alerts (from /metrics handler)
    #
    - name: application-alerts
      rules:
      #
      # Alert on each 5XX code of any http service
      #
      - alert: HttpServiceFatalError
        expr: rate(http_request_duration_seconds{job="kubernetes-service-endpoints",status=~"5.."}[1m])
          > 0
        labels:
          notify: sre
          severity: warning
        annotations:
          summary: "{{ $labels.namespace }}/{{ $label.name }}: Service returns 5XX error"
          description: "{{ $labels.namespace }}/{{ $label.name }}: Service has processed some request incorrectly (code = {{ $labels.status }})"

      #
      # Alert for any instance that have a median request latency > 0.5s
      #
      - alert: HttpServiceHighRequestLatency
        expr: http_request_duration_seconds{quantile="0.5"} > 0.5
        for: 1m
        labels:
          notify: sre
          severity: warning
        annotations:
          summary: "{{ $labels.namespace }}/{{ $label.name }}: High request latency"
          description: "{{ $labels.namespace }}/{{ $label.name }} (instance {{ $labels.instance }}): Service has a median request latency > 0.5s (current value: {{ $value }}s)"
{% endraw %}
